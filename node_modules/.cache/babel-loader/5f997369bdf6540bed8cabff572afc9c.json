{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return _possibleConstructorReturn(this, result);\n  };\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nimport React, { Component, forwardRef } from 'react';\nimport { getPosX, throttle } from './utils';\nvar ProgressBar = function (_Component) {\n  _inherits(ProgressBar, _Component);\n  var _super = _createSuper(ProgressBar);\n  function ProgressBar() {\n    var _this;\n    _classCallCheck(this, ProgressBar);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _super.call.apply(_super, [this].concat(args));\n    _defineProperty(_assertThisInitialized(_this), \"audio\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"timeOnMouseMove\", 0);\n    _defineProperty(_assertThisInitialized(_this), \"hasAddedAudioEventListener\", false);\n    _defineProperty(_assertThisInitialized(_this), \"downloadProgressAnimationTimer\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      isDraggingProgress: false,\n      currentTimePos: '0%',\n      hasDownloadProgressAnimation: false,\n      downloadProgressArr: [],\n      waitingForSeekCallback: false\n    });\n    _defineProperty(_assertThisInitialized(_this), \"getCurrentProgress\", function (event) {\n      var _this$props = _this.props,\n        audio = _this$props.audio,\n        progressBar = _this$props.progressBar;\n      var isSingleFileProgressiveDownload = audio.src.indexOf('blob:') !== 0 && typeof _this.props.srcDuration === 'undefined';\n      if (isSingleFileProgressiveDownload && (!audio.src || !isFinite(audio.currentTime) || !progressBar.current)) {\n        return {\n          currentTime: 0,\n          currentTimePos: '0%'\n        };\n      }\n      var progressBarRect = progressBar.current.getBoundingClientRect();\n      var maxRelativePos = progressBarRect.width;\n      var relativePos = getPosX(event) - progressBarRect.left;\n      if (relativePos < 0) {\n        relativePos = 0;\n      } else if (relativePos > maxRelativePos) {\n        relativePos = maxRelativePos;\n      }\n      var duration = _this.getDuration();\n      var currentTime = duration * relativePos / maxRelativePos;\n      return {\n        currentTime: currentTime,\n        currentTimePos: \"\".concat((relativePos / maxRelativePos * 100).toFixed(2), \"%\")\n      };\n    });\n    _defineProperty(_assertThisInitialized(_this), \"handleContextMenu\", function (event) {\n      event.preventDefault();\n    });\n    _defineProperty(_assertThisInitialized(_this), \"handleMouseDownOrTouchStartProgressBar\", function (event) {\n      event.stopPropagation();\n      var _this$getCurrentProgr = _this.getCurrentProgress(event.nativeEvent),\n        currentTime = _this$getCurrentProgr.currentTime,\n        currentTimePos = _this$getCurrentProgr.currentTimePos;\n      if (isFinite(currentTime)) {\n        _this.timeOnMouseMove = currentTime;\n        _this.setState({\n          isDraggingProgress: true,\n          currentTimePos: currentTimePos\n        });\n        if (event.nativeEvent instanceof MouseEvent) {\n          window.addEventListener('mousemove', _this.handleWindowMouseOrTouchMove);\n          window.addEventListener('mouseup', _this.handleWindowMouseOrTouchUp);\n        } else {\n          window.addEventListener('touchmove', _this.handleWindowMouseOrTouchMove);\n          window.addEventListener('touchend', _this.handleWindowMouseOrTouchUp);\n        }\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"handleWindowMouseOrTouchMove\", function (event) {\n      if (event instanceof MouseEvent) {\n        event.preventDefault();\n      }\n      event.stopPropagation();\n      var windowSelection = window.getSelection();\n      if (windowSelection && windowSelection.type === 'Range') {\n        windowSelection.empty();\n      }\n      var isDraggingProgress = _this.state.isDraggingProgress;\n      if (isDraggingProgress) {\n        var _this$getCurrentProgr2 = _this.getCurrentProgress(event),\n          currentTime = _this$getCurrentProgr2.currentTime,\n          currentTimePos = _this$getCurrentProgr2.currentTimePos;\n        _this.timeOnMouseMove = currentTime;\n        _this.setState({\n          currentTimePos: currentTimePos\n        });\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"handleWindowMouseOrTouchUp\", function (event) {\n      event.stopPropagation();\n      var newTime = _this.timeOnMouseMove;\n      var _this$props2 = _this.props,\n        audio = _this$props2.audio,\n        onChangeCurrentTimeError = _this$props2.onChangeCurrentTimeError,\n        onSeek = _this$props2.onSeek;\n      if (onSeek) {\n        _this.setState({\n          isDraggingProgress: false,\n          waitingForSeekCallback: true\n        }, function () {\n          onSeek(audio, newTime).then(function () {\n            return _this.setState({\n              waitingForSeekCallback: false\n            });\n          }, function (err) {\n            throw new Error(err);\n          });\n        });\n      } else {\n        var newProps = {\n          isDraggingProgress: false\n        };\n        if (audio.readyState === audio.HAVE_NOTHING || audio.readyState === audio.HAVE_METADATA || !isFinite(newTime)) {\n          newProps.currentTimePos = '0%';\n          onChangeCurrentTimeError && onChangeCurrentTimeError();\n        } else {\n          audio.currentTime = newTime;\n        }\n        _this.setState(newProps);\n      }\n      if (event instanceof MouseEvent) {\n        window.removeEventListener('mousemove', _this.handleWindowMouseOrTouchMove);\n        window.removeEventListener('mouseup', _this.handleWindowMouseOrTouchUp);\n      } else {\n        window.removeEventListener('touchmove', _this.handleWindowMouseOrTouchMove);\n        window.removeEventListener('touchend', _this.handleWindowMouseOrTouchUp);\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"handleAudioTimeUpdate\", throttle(function (e) {\n      var isDraggingProgress = _this.state.isDraggingProgress;\n      var audio = e.target;\n      if (isDraggingProgress || _this.state.waitingForSeekCallback === true) return;\n      var currentTime = audio.currentTime;\n      var duration = _this.getDuration();\n      _this.setState({\n        currentTimePos: \"\".concat((currentTime / duration * 100 || 0).toFixed(2), \"%\")\n      });\n    }, _this.props.progressUpdateInterval));\n    _defineProperty(_assertThisInitialized(_this), \"handleAudioDownloadProgressUpdate\", function (e) {\n      var audio = e.target;\n      var duration = _this.getDuration();\n      var downloadProgressArr = [];\n      for (var i = 0; i < audio.buffered.length; i++) {\n        var bufferedStart = audio.buffered.start(i);\n        var bufferedEnd = audio.buffered.end(i);\n        downloadProgressArr.push({\n          left: \"\".concat(Math.round(100 / duration * bufferedStart) || 0, \"%\"),\n          width: \"\".concat(Math.round(100 / duration * (bufferedEnd - bufferedStart)) || 0, \"%\")\n        });\n      }\n      clearTimeout(_this.downloadProgressAnimationTimer);\n      _this.setState({\n        downloadProgressArr: downloadProgressArr,\n        hasDownloadProgressAnimation: true\n      });\n      _this.downloadProgressAnimationTimer = setTimeout(function () {\n        _this.setState({\n          hasDownloadProgressAnimation: false\n        });\n      }, 200);\n    });\n    return _this;\n  }\n  _createClass(ProgressBar, [{\n    key: \"getDuration\",\n    value: function getDuration() {\n      var _this$props3 = this.props,\n        audio = _this$props3.audio,\n        srcDuration = _this$props3.srcDuration;\n      return typeof srcDuration === 'undefined' ? audio.duration : srcDuration;\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      var audio = this.props.audio;\n      if (audio && !this.hasAddedAudioEventListener) {\n        this.audio = audio;\n        this.hasAddedAudioEventListener = true;\n        audio.addEventListener('timeupdate', this.handleAudioTimeUpdate);\n        audio.addEventListener('progress', this.handleAudioDownloadProgressUpdate);\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      if (this.audio && this.hasAddedAudioEventListener) {\n        this.audio.removeEventListener('timeupdate', this.handleAudioTimeUpdate);\n        this.audio.removeEventListener('progress', this.handleAudioDownloadProgressUpdate);\n      }\n      clearTimeout(this.downloadProgressAnimationTimer);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props4 = this.props,\n        showDownloadProgress = _this$props4.showDownloadProgress,\n        showFilledProgress = _this$props4.showFilledProgress,\n        progressBar = _this$props4.progressBar,\n        i18nProgressBar = _this$props4.i18nProgressBar;\n      var _this$state = this.state,\n        currentTimePos = _this$state.currentTimePos,\n        downloadProgressArr = _this$state.downloadProgressArr,\n        hasDownloadProgressAnimation = _this$state.hasDownloadProgressAnimation;\n      return React.createElement(\"div\", {\n        className: \"rhap_progress-container\",\n        ref: progressBar,\n        \"aria-label\": i18nProgressBar,\n        role: \"progressbar\",\n        \"aria-valuemin\": 0,\n        \"aria-valuemax\": 100,\n        \"aria-valuenow\": Number(currentTimePos.split('%')[0]),\n        tabIndex: 0,\n        onMouseDown: this.handleMouseDownOrTouchStartProgressBar,\n        onTouchStart: this.handleMouseDownOrTouchStartProgressBar,\n        onContextMenu: this.handleContextMenu\n      }, React.createElement(\"div\", {\n        className: \"rhap_progress-bar \".concat(showDownloadProgress ? 'rhap_progress-bar-show-download' : '')\n      }, React.createElement(\"div\", {\n        className: \"rhap_progress-indicator\",\n        style: {\n          left: currentTimePos\n        }\n      }), showFilledProgress && React.createElement(\"div\", {\n        className: \"rhap_progress-filled\",\n        style: {\n          width: currentTimePos\n        }\n      }), showDownloadProgress && downloadProgressArr.map(function (_ref, i) {\n        var left = _ref.left,\n          width = _ref.width;\n        return React.createElement(\"div\", {\n          key: i,\n          className: \"rhap_download-progress\",\n          style: {\n            left: left,\n            width: width,\n            transitionDuration: hasDownloadProgressAnimation ? '.2s' : '0s'\n          }\n        });\n      })));\n    }\n  }]);\n  return ProgressBar;\n}(Component);\nvar ProgressBarForwardRef = function ProgressBarForwardRef(props, ref) {\n  return React.createElement(ProgressBar, _extends({}, props, {\n    progressBar: ref\n  }));\n};\nexport default forwardRef(ProgressBarForwardRef);\nexport { ProgressBar, ProgressBarForwardRef };","map":null,"metadata":{},"sourceType":"module"}